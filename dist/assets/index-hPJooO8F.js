var ce=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};import{r as m,a as fn,R as G,g as pn}from"./vendor-sIYcyGZc.js";import{H as K}from"./hls-YqUsZ1Jx.js";function hn(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Ht={exports:{}},Me={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mn=m,gn=Symbol.for("react.element"),yn=Symbol.for("react.fragment"),bn=Object.prototype.hasOwnProperty,vn=mn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xn={key:!0,ref:!0,__self:!0,__source:!0};function Gt(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)bn.call(e,r)&&!xn.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:gn,type:n,key:i,ref:o,props:s,_owner:vn.current}}Me.Fragment=yn;Me.jsx=Gt;Me.jsxs=Gt;Ht.exports=Me;var c=Ht.exports,Ye={},Rt=fn;Ye.createRoot=Rt.createRoot,Ye.hydrateRoot=Rt.hydrateRoot;/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),_n=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Tt=n=>{const e=_n(n);return e.charAt(0).toUpperCase()+e.slice(1)},Jt=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),Sn=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var kn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=m.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:o,...a},l)=>m.createElement("svg",{ref:l,...kn,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:Jt("lucide",s),...!i&&!Sn(a)&&{"aria-hidden":"true"},...a},[...o.map(([u,d])=>m.createElement(u,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=(n,e)=>{const t=m.forwardRef(({className:r,...s},i)=>m.createElement(Rn,{ref:i,iconNode:e,className:Jt(`lucide-${Cn(Tt(n))}`,`lucide-${n}`,r),...s}));return t.displayName=Tt(n),t};/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Pt=A("arrow-left",Tn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Je=A("check",Pn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],jn=A("clipboard-check",En);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],Ln=A("clipboard",Mn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],On=A("cloud",Dn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],In=A("maximize",Nn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],An=A("minimize",$n);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]],Et=A("party-popper",Fn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Bn=A("pause",wn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],jt=A("play",Un);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Mt=A("settings",zn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Hn=A("upload",Vn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Jn=A("volume-2",Gn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Kn=A("volume-x",Wn);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Yn=A("x",qn);var Wt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Lt=G.createContext&&G.createContext(Wt),Xn=["attr","size","title"];function Qn(n,e){if(n==null)return{};var t=Zn(n,e),r,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function Zn(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function Te(){return Te=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Te.apply(this,arguments)}function Dt(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Pe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Dt(Object(t),!0).forEach(function(r){es(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Dt(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function es(n,e,t){return e=ts(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ts(n){var e=rs(n,"string");return typeof e=="symbol"?e:e+""}function rs(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Kt(n){return n&&n.map((e,t)=>G.createElement(e.tag,Pe({key:t},e.attr),Kt(e.child)))}function qt(n){return e=>G.createElement(ns,Te({attr:Pe({},n.attr)},e),Kt(n.child))}function ns(n){var e=t=>{var{attr:r,size:s,title:i}=n,o=Qn(n,Xn),a=s||t.size||"1em",l;return t.className&&(l=t.className),n.className&&(l=(l?l+" ":"")+n.className),G.createElement("svg",Te({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:l,style:Pe(Pe({color:n.color||t.color},t.style),n.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),i&&G.createElement("title",null,i),n.children)};return Lt!==void 0?G.createElement(Lt.Consumer,null,t=>e(t)):e(Wt)}function ss(n){return qt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 9l-3 -3l3 -3"},child:[]},{tag:"path",attr:{d:"M15.997 17.918a6.002 6.002 0 0 0 -.997 -11.918h-11"},child:[]},{tag:"path",attr:{d:"M6 14v6"},child:[]},{tag:"path",attr:{d:"M9 15.5v3a1.5 1.5 0 0 0 3 0v-3a1.5 1.5 0 0 0 -3 0z"},child:[]}]})(n)}function is(n){return qt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 9l3 -3l-3 -3"},child:[]},{tag:"path",attr:{d:"M8 17.918a5.997 5.997 0 0 1 -5 -5.918a6 6 0 0 1 6 -6h11"},child:[]},{tag:"path",attr:{d:"M12 14v6"},child:[]},{tag:"path",attr:{d:"M15 15.5v3a1.5 1.5 0 0 0 3 0v-3a1.5 1.5 0 0 0 -3 0z"},child:[]}]})(n)}class os{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return as(e).buffer}}function as(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);t.set(i,r),r+=s.byteLength}return t}function Yt(n){return new cs(n).unpack()}function Xt(n){const e=new ls,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class cs{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,s="",i,o;for(;r<e;)i=t[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|t[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(o=(i&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const s=this.unpack();t[s]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(t===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+t*2**(s-52);return(r===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class ls{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=s=>{if(s<t){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,a=t<<31|r+1023<<20|i/o&1048575,l=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(l)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<t.length){const o=t[i];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new os,this._textEncoder=new TextEncoder}}let Qt=!0,Zt=!0;function de(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseFloat(r[t],10)}function X(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const l=u=>{const d=t(u);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),s.apply(this,[o,l])};const i=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(a))return i.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,l])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function ds(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Qt=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function us(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Zt=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function er(){if(typeof window=="object"){if(Qt)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function lt(n,e){Zt&&console.warn(n+" is deprecated, please use "+e+" instead.")}function fs(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(de(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(de(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(de(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=de(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Ot(n){return Object.prototype.toString.call(n)==="[object Object]"}function tr(n){return Ot(n)?Object.keys(n).reduce(function(e,t){const r=Ot(n[t]),s=r?tr(n[t]):n[t],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[t]:s})},{}):n}function Xe(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Xe(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(s=>{Xe(n,n.get(s),t)})}))}function Nt(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{n.forEach(a=>{a.type===r&&a.trackId===o.id&&Xe(n,a,s)})}),s}const It=er;function rr(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof a[u]=="object"?a[u]:{ideal:a[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const f=function(h,b){return h?h+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(d.ideal!==void 0){l.optional=l.optional||[];let h={};typeof d.ideal=="number"?(h[f("min",u)]=d.ideal,l.optional.push(h),h={},h[f("max",u)]=d.ideal,l.optional.push(h)):(h[f("",u)]=d.ideal,l.optional.push(h))}d.exact!==void 0&&typeof d.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",u)]=d.exact):["min","max"].forEach(h=>{d[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(h,u)]=d[h])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},s=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(d,f,h){f in d&&!(h in d)&&(d[h]=d[f],delete d[f])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return t.mediaDevices.enumerateDevices().then(h=>{h=h.filter(x=>x.kind==="videoinput");let b=h.find(x=>f.some(R=>x.label.toLowerCase().includes(R)));return!b&&h.length&&f.includes("back")&&(b=h[h.length-1]),b&&(a.video.deviceId=u.exact?{exact:b.deviceId}:{ideal:b.deviceId}),a.video=r(a.video),It("chrome: "+JSON.stringify(a)),l(a)})}a.video=r(a.video)}return It("chrome: "+JSON.stringify(a)),l(a)},i=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,u){s(a,d=>{t.webkitGetUserMedia(d,l,f=>{u&&u(i(f))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return s(l,u=>a(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(i(d))))}}}function nr(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function sr(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else X(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function ir(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let u=s.apply(this,arguments);return u||(u=e(this,a),this._senders.push(u)),u};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){i.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],t.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function or(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Nt(o,i.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(i=>i._pc=this),s}),X(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>Nt(i,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(a=>{a.track===r&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===r&&(i?o=!0:i=a),a.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function ar(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function cr(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return ar(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const d=t.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(f=>this._reverseStreams[f.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(b=>b.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const f=new n.MediaStream(d.getTracks());this._streams[d.id]=f,this._reverseStreams[f.id]=d,d=f}r.apply(this,[d])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},n.RTCPeerConnection.prototype.addTrack=function(d,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(R=>R===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(R=>R.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const x=this._streams[f.id];if(x)x.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const R=new n.MediaStream([d]);this._streams[f.id]=R,this._reverseStreams[R.id]=f,this.addStream(R)}return this.getSenders().find(R=>R.track===d)};function i(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const b=u._reverseStreams[h],x=u._streams[b.id];f=f.replace(new RegExp(x.id,"g"),b.id)}),new RTCSessionDescription({type:d.type,sdp:f})}function o(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const b=u._reverseStreams[h],x=u._streams[b.id];f=f.replace(new RegExp(b.id,"g"),x.id)}),new RTCSessionDescription({type:d.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const d=n.RTCPeerConnection.prototype[u],f={[u](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[x=>{const R=i(this,x);h[0].apply(null,[R])},x=>{h[1]&&h[1].apply(null,x)},arguments[2]]):d.apply(this,arguments).then(x=>i(this,x))}};n.RTCPeerConnection.prototype[u]=f[u]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:i(this,u)}}),n.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(R=>d.track===R)&&(h=this._streams[b])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Qe(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function lr(n,e){X(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const $t=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:lr,shimAddTrackRemoveTrack:cr,shimAddTrackRemoveTrackWithNative:ar,shimGetSendersWithDtmf:ir,shimGetUserMedia:rr,shimMediaStream:nr,shimOnTrack:sr,shimPeerConnection:Qe,shimSenderReceiverGetStats:or},Symbol.toStringTag,{value:"Module"}));function dr(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,i,o){lt("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function ps(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function ur(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ze(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=n.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=o[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,o,a]=arguments;return r.apply(this,[i||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(u=>{u.type=t[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((d,f)=>{l.set(f,Object.assign({},d,{type:t[d.type]||d.type}))})}return l}).then(o,a)}}function fr(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function pr(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),X(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function hr(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){lt("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function mr(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function gr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function yr(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function br(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function vr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const At=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:gr,shimCreateAnswer:vr,shimCreateOffer:br,shimGetDisplayMedia:ps,shimGetParameters:yr,shimGetUserMedia:dr,shimOnTrack:ur,shimPeerConnection:Ze,shimRTCDataChannel:mr,shimReceiverGetStats:pr,shimRemoveStream:hr,shimSenderGetStats:fr},Symbol.toStringTag,{value:"Module"}));function xr(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const s=t.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function Cr(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function _r(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],h=t.apply(this,[f]);return d?(h.then(u,d),Promise.resolve()):h},e.createAnswer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[f]);return d?(h.then(u,d),Promise.resolve()):h};let a=function(l,u,d){const f=s.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f};e.setLocalDescription=a,a=function(l,u,d){const f=i.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},e.setRemoteDescription=a,a=function(l,u,d){const f=o.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},e.addIceCandidate=a}function Sr(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>r(kr(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function kr(n){return n&&n.video!==void 0?Object.assign({},n,{video:tr(n.video)}):n}function Rr(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(lt("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Tr(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Pr(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Er(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const Ft=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Er,shimCallbacksAPI:_r,shimConstraints:kr,shimCreateOfferLegacy:Pr,shimGetUserMedia:Sr,shimLocalStreamsAPI:xr,shimRTCIceServerUrls:Rr,shimRemoteStreamsAPI:Cr,shimTrackEventTransceiver:Tr},Symbol.toStringTag,{value:"Module"}));var jr={exports:{}};(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const s=t.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const i=t.type;return r.push("typ"),r.push(i),i!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const s=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let s;const i=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(t){let r="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const i=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?i.push(o+"="+t.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),s={ssrc:parseInt(t.substring(7,r),10)},i=t.indexOf(":",r);return i>-1?(s.attribute=t.substring(r+1,i),s.value=t.substring(i+1)):s.attribute=t.substring(r+1),s},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let s="a=setup:"+r+`\r
`;return t.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const s=e.matchPrefix(t+r,"a=ice-ufrag:")[0],i=e.matchPrefix(t+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const l=i[a],u=e.matchPrefix(t,"a=rtpmap:"+l+" ")[0];if(u){const d=e.parseRtpMap(u),f=e.matchPrefix(t,"a=fmtp:"+l+" ");switch(d.parameters=f.length?e.parseFmtp(f[0]):{},d.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),r.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),r},e.writeRtpDescription=function(t,r){let s="";s+="m="+t+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(t){const r=[],s=e.parseRtpParameters(t),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=a.length>0&&a[0].ssrc;let u;const d=e.matchPrefix(t,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(x=>parseInt(x,10)));d.length>0&&d[0].length>1&&d[0][0]===l&&(u=d[0][1]),s.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let b={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&u&&(b.rtx={ssrc:u}),r.push(b),i&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},r.push(b))}}),r.length===0&&l&&r.push({ssrc:l});let f=e.matchPrefix(t,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,r.forEach(h=>{h.maxBitrate=f})),r},e.parseRtcpParameters=function(t){const r={},s=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const s=e.matchPrefix(t,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:i}}},e.writeSctpDescription=function(t,r){let s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,s){let i;const o=r!==void 0?r:2;return t?i=t:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const s=e.splitLines(t);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const s=e.splitLines(t)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){const s=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(jr);var Mr=jr.exports;const re=pn(Mr),hs=hn({__proto__:null,default:re},[Mr]);function xe(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=re.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,X(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function et(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||X(n,"icecandidate",e=>{if(e.candidate){const t=re.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Ce(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const l=re.splitSections(a.sdp);return l.shift(),l.some(u=>{const d=re.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!==u?-1:u},s=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},i=function(a,l){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const d=re.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(u=2147483637),u},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=r(arguments[0]),u=s(l),d=i(arguments[0],l);let f;u===0&&d===0?f=Number.POSITIVE_INFINITY:u===0||d===0?f=Math.max(u,d):f=Math.min(u,d);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return f}}),this._sctp=h}return o.apply(this,arguments)}}function _e(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(r.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},X(n,"datachannel",r=>(e(r.channel,r.target),r))}function tt(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function rt(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return t.apply(this,arguments)}}function Se(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ke(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return t.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?t.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const ms=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:rt,shimAddIceCandidateNullOrEmpty:Se,shimConnectionState:tt,shimMaxMessageSize:Ce,shimParameterlessSetLocalDescription:ke,shimRTCIceCandidate:xe,shimRTCIceCandidateRelayProtocol:et,shimSendThrowTypeError:_e},Symbol.toStringTag,{value:"Module"}));function gs({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=er,r=fs(n),s={browserDetails:r,commonShim:ms,extractVersion:de,disableLog:ds,disableWarnings:us,sdp:hs};switch(r.browser){case"chrome":if(!$t||!Qe||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=$t,Se(n,r),ke(n),rr(n,r),nr(n),Qe(n,r),sr(n),cr(n,r),ir(n),or(n),lr(n,r),xe(n),et(n),tt(n),Ce(n,r),_e(n),rt(n,r);break;case"firefox":if(!At||!Ze||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=At,Se(n,r),ke(n),dr(n,r),Ze(n,r),ur(n),hr(n),fr(n),pr(n),mr(n),gr(n),yr(n),br(n),vr(n),xe(n),tt(n),Ce(n,r),_e(n);break;case"safari":if(!Ft||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=Ft,Se(n,r),ke(n),Rr(n),Pr(n),_r(n),xr(n),Cr(n),Tr(n),Sr(n),Er(n),xe(n),et(n),Ce(n,r),_e(n),rt(n,r);break;default:t("Unsupported browser!");break}return s}const wt=gs({window:typeof window>"u"?void 0:window});function Q(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class Lr{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),l=e.slice(o,a),u={__peerData:this._dataCount,n:i,data:l,total:s};t.push(u),o=a,i++}return this._dataCount++,t}}}function ys(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.byteLength;return t}const We=wt.default||wt,le=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return We.browserDetails.browser}getVersion(){return We.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=We.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},bs=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),Dr=()=>Math.random().toString(36).slice(2),Bt={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class vs extends Lr{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(s){s.target&&t(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Bt,this.browser=le.getBrowser(),this.browserVersion=le.getVersion(),this.pack=Xt,this.unpack=Yt,this.supports=function(){const t={browser:le.isBrowserSupported(),webRTC:le.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(Bt),t.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!s.ordered;try{s.binaryType="blob",t.binaryBlob=!le.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return t}(),this.validateId=bs,this.randomToken=Dr}}const B=new vs,xs="PeerJS: ";class Cs{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[xs,...t];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var g=new Cs,dt={},_s=Object.prototype.hasOwnProperty,$="~";function pe(){}Object.create&&(pe.prototype=Object.create(null),new pe().__proto__||($=!1));function Ss(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Or(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Ss(t,r||n,s),o=$?$+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],i]:n._events[o].push(i):(n._events[o]=i,n._eventsCount++),n}function Re(n,e){--n._eventsCount===0?n._events=new pe:delete n._events[e]}function O(){this._events=new pe,this._eventsCount=0}O.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)_s.call(t,r)&&e.push($?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};O.prototype.listeners=function(e){var t=$?$+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};O.prototype.listenerCount=function(e){var t=$?$+e:e,r=this._events[t];return r?r.fn?1:r.length:0};O.prototype.emit=function(e,t,r,s,i,o){var a=$?$+e:e;if(!this._events[a])return!1;var l=this._events[a],u=arguments.length,d,f;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,s),!0;case 5:return l.fn.call(l.context,t,r,s,i),!0;case 6:return l.fn.call(l.context,t,r,s,i,o),!0}for(f=1,d=new Array(u-1);f<u;f++)d[f-1]=arguments[f];l.fn.apply(l.context,d)}else{var h=l.length,b;for(f=0;f<h;f++)switch(l[f].once&&this.removeListener(e,l[f].fn,void 0,!0),u){case 1:l[f].fn.call(l[f].context);break;case 2:l[f].fn.call(l[f].context,t);break;case 3:l[f].fn.call(l[f].context,t,r);break;case 4:l[f].fn.call(l[f].context,t,r,s);break;default:if(!d)for(b=1,d=new Array(u-1);b<u;b++)d[b-1]=arguments[b];l[f].fn.apply(l[f].context,d)}}return!0};O.prototype.on=function(e,t,r){return Or(this,e,t,r,!1)};O.prototype.once=function(e,t,r){return Or(this,e,t,r,!0)};O.prototype.removeListener=function(e,t,r,s){var i=$?$+e:e;if(!this._events[i])return this;if(!t)return Re(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!s||o.once)&&(!r||o.context===r)&&Re(this,i);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==t||s&&!o[a].once||r&&o[a].context!==r)&&l.push(o[a]);l.length?this._events[i]=l.length===1?l[0]:l:Re(this,i)}return this};O.prototype.removeAllListeners=function(e){var t;return e?(t=$?$+e:e,this._events[t]&&Re(this,t)):(this._events=new pe,this._eventsCount=0),this};O.prototype.off=O.prototype.removeListener;O.prototype.addListener=O.prototype.on;O.prefixed=$;O.EventEmitter=O;dt=O;var Z={};Q(Z,"ConnectionType",()=>J);Q(Z,"PeerErrorType",()=>P);Q(Z,"BaseConnectionErrorType",()=>nt);Q(Z,"DataConnectionErrorType",()=>ut);Q(Z,"SerializationType",()=>Le);Q(Z,"SocketEventType",()=>H);Q(Z,"ServerMessageType",()=>D);var J=function(n){return n.Data="data",n.Media="media",n}({}),P=function(n){return n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc",n}({}),nt=function(n){return n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed",n}({}),ut=function(n){return n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big",n}({}),Le=function(n){return n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw",n}({}),H=function(n){return n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close",n}({}),D=function(n){return n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE",n}({});const Nr="1.5.5";class ks extends dt.EventEmitter{constructor(e,t,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+r+s+"peerjs?key="+i}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Nr),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),g.log("Server message received:",i)}catch{g.log("Invalid server message",s.data);return}this.emit(H.Message,i)},this._socket.onclose=s=>{this._disconnected||(g.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(H.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),g.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){g.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:D.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(H.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class Ir{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===J.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=t.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){g.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;g.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(g.log(`Received ICE candidates for ${t}:`,o.candidate),i.socket.send({type:D.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":g.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(nt.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":g.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(nt.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":g.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},g.log("Listening for data channel"),e.ondatachannel=o=>{g.log("Received data channel");const a=o.channel;i.getConnection(t,r)._initializeDataChannel(a)},g.log("Listening for remote stream"),e.ontrack=o=>{g.log("Received remote stream");const a=o.streams[0],l=i.getConnection(t,r);if(l.type===J.Media){const u=l;this._addStreamToMediaConnection(a,u)}}}cleanup(){g.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);g.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),g.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===J.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}t.socket.send({type:D.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(P.WebRTC,s),g.log("Failed to setLocalDescription, ",s))}}catch(r){t.emitError(P.WebRTC,r),g.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();g.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),g.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:D.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){t.emitError(P.WebRTC,s),g.log("Failed to setLocalDescription, ",s)}}catch(r){t.emitError(P.WebRTC,r),g.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,s=this.connection.provider;g.log("Setting remote description",t);const i=this;try{await r.setRemoteDescription(t),g.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(P.WebRTC,o),g.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){g.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),g.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(P.WebRTC,t),g.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(g.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return g.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){g.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class $r extends dt.EventEmitter{emitError(e,t){g.error("Error:",t),this.emit("error",new Rs(`${e}`,t))}}class Rs extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class Ar extends $r{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}var it;const ue=class ue extends Ar{get type(){return J.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||ue.ID_PREFIX+B.randomToken(),this._negotiator=new Ir(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{g.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{g.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){g.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case D.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case D.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:g.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){g.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};it=new WeakMap,ce(ue,it,ue.ID_PREFIX="mc_");let Ee=ue;class Ts{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,a=new URL(`${t}://${r}:${s}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",Nr),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){g.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==B.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===B.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw g.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var ot,at;const Y=class Y extends Ar{get type(){return J.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||Y.ID_PREFIX+Dr(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new Ir(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{g.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{g.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{g.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(ut.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case D.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case D.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:g.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};ot=new WeakMap,at=new WeakMap,ce(Y,ot,Y.ID_PREFIX="dc_"),ce(Y,at,Y.MAX_BUFFERED_AMOUNT=8388608);let je=Y;class ft extends je{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>je.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return g.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Ke extends ft{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new Lr,this.serialization=Le.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=Yt(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const s=ys(r.data);this._handleDataMessage({data:s})}}_send(e,t){const r=Xt(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);g.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class Ps extends ft{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Le.None}}class Es extends ft{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=B.chunkedMTU){this.emitError(ut.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Le.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var ct;const fe=class fe extends $r{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:Ps,json:Es,binary:Ke,"binary-utf8":Ke,default:Ke},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:B.CLOUD_HOST,port:B.CLOUD_PORT,path:"/",key:fe.DEFAULT_KEY,token:B.randomToken(),config:B.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==B.CLOUD_HOST?this._options.secure=B.isSecure():this._options.host==B.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&g.setLogFunction(this._options.logFunction),g.logLevel=this._options.debug||0,this._api=new Ts(t),this._socket=this._createServerConnection(),!B.supports.audioVideo&&!B.supports.data){this._delayedAbort(P.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!B.validateId(r)){this._delayedAbort(P.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(P.ServerError,s))}_createServerConnection(){const e=new ks(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(H.Message,t=>{this._handleMessage(t)}),e.on(H.Error,t=>{this._abort(P.SocketError,t)}),e.on(H.Disconnected,()=>{this.disconnected||(this.emitError(P.Network,"Lost connection to server."),this.disconnect())}),e.on(H.Close,()=>{this.disconnected||this._abort(P.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,s=e.src;switch(t){case D.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case D.Error:this._abort(P.ServerError,r.msg);break;case D.IdTaken:this._abort(P.UnavailableID,`ID "${this.id}" is taken`);break;case D.InvalidKey:this._abort(P.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case D.Leave:g.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case D.Expire:this.emitError(P.PeerUnavailable,`Could not connect to peer ${s}`);break;case D.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),g.warn(`Offer received for existing Connection ID:${i}`)),r.type===J.Media){const l=new Ee(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=l,this._addConnection(s,o),this.emit("call",l)}else if(r.type===J.Data){const l=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=l,this._addConnection(s,o),this.emit("connection",l)}else{g.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(i);for(const l of a)o.handleMessage(l);break}default:{if(!r){g.warn(`You received a malformed message from ${s} of type ${t}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):g.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){g.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(P.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){g.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(P.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){g.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new Ee(e,this,{...r,_stream:t});return this._addConnection(e,s),s}_addConnection(e,t){g.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===t)return s;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){g.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(g.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;g.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)g.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)g.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(P.ServerError,t))}};ct=new WeakMap,ce(fe,ct,fe.DEFAULT_KEY="peerjs");let st=fe;var js=st;const Ms=({onMessage:n,onStatusChange:e})=>{const t=m.useRef(null),r=m.useRef(null),s=m.useRef(new Map),[i,o]=m.useState(null),[a,l]=m.useState(!1),[u,d]=m.useState(null),f=m.useRef(n),h=m.useRef(e);m.useEffect(()=>{f.current=n,h.current=e});const b=m.useCallback(()=>{r.current&&r.current.close(),s.current.forEach(F=>F.close()),t.current&&t.current.destroy(),r.current=null,s.current.clear(),t.current=null,o(null),l(!1),d(null),h.current("disconnected")},[]),x=m.useCallback((F,T=null)=>{var U;if(u==="host")if(T){const N=s.current.get(T);N!=null&&N.open&&N.send(F)}else s.current.forEach(N=>N.send(F));else u==="guest"&&((U=r.current)!=null&&U.open)&&r.current.send(F)},[u]),R=m.useCallback((F=void 0)=>{t.current&&t.current.destroy();const T=new js(F,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]}});return T.on("error",U=>{console.error("PeerJS error:",U),h.current("error"),(U.type==="unavailable-id"||U.type==="peer-unavailable")&&alert("Could not connect to the party. The ID might be invalid or the host has disconnected."),b()}),T.on("disconnected",()=>{h.current("connecting")}),T},[b]),he=m.useCallback(()=>{const F=R();d("host"),F.on("open",T=>{o(T),l(!0),h.current("hosting")}),F.on("connection",T=>{s.current.set(T.peer,T),h.current("hosting"),T.on("data",U=>f.current(U,T.peer)),T.on("close",()=>{s.current.delete(T.peer),h.current("hosting")})})},[R]),L=m.useCallback(F=>{const T=R();d("guest"),T.on("open",U=>{h.current("connecting");const N=T.connect(F,{reliable:!0});r.current=N,N.on("open",()=>{l(!0),h.current("connected"),x({type:"SYNC_REQUEST"})}),N.on("data",me=>f.current(me,N.peer)),N.on("close",()=>{alert("Disconnected from the party host."),b()})})},[R,b,x]);return m.useEffect(()=>()=>b(),[b]),{peerId:i,isPartyActive:a,partyRole:u,sendMessage:x,startParty:he,joinParty:L,endParty:b}},Ls=n=>c.jsx("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n,children:c.jsx("path",{d:"M1 18V20H5V18H1ZM1 14V16H8V14H1ZM1 10V12H12V10H1ZM21 3H3C1.9 3 1 3.9 1 5V8H3V5H21V19H14V21H21C22.1 21 23 20.1 23 19V5C23 3.9 22.1 3 21 3Z"})}),Ut=n=>{if(isNaN(n)||n<0)return"00:00";const e=new Date(n*1e3).toISOString().slice(11,19);return n<3600?e.slice(3):e},zt=({open:n,onOpenChange:e,children:t})=>n?c.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center pointer-events-auto",children:[c.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>e(!1)}),c.jsxs("div",{className:"relative bg-black/60 backdrop-blur-xl border border-white/10 rounded-lg shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[c.jsx("button",{onClick:()=>e(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors z-10 p-1 rounded-full hover:bg-white/10","aria-label":"Close dialog",children:c.jsx(Yn,{size:24})}),t]})]}):null,q=({children:n,onClick:e,variant:t="ghost",size:r="default",className:s="",disabled:i=!1})=>{const o="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50",a={default:"bg-white/20 text-white",ghost:"text-white hover:bg-white/10",outline:"border border-white/10 text-white hover:bg-white/10"},l={default:"h-10 px-4 py-2",sm:"h-8 px-3 text-sm",lg:"h-12 px-8"};return c.jsx("button",{onClick:e,disabled:i,className:`${o} ${a[t]} ${l[r]} ${s}`,children:n})},Ds=({open:n,onOpenChange:e,trigger:t,children:r})=>{const s=m.useRef(null),i=m.useRef(null),[o,a]=m.useState({top:0,left:0});return m.useEffect(()=>{if(n&&s.current&&i.current){const l=s.current.getBoundingClientRect(),u=i.current.getBoundingClientRect();a({top:l.top-u.height-10,left:l.left+l.width/2-u.width/2})}},[n]),c.jsxs("div",{className:"relative",children:[c.jsx("div",{ref:s,onClick:()=>e(!n),children:t}),n&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>e(!1)}),c.jsx("div",{ref:i,className:"fixed z-50 bg-black/60 backdrop-blur-xl border border-white/10 rounded-lg shadow-2xl",style:{top:`${o.top}px`,left:`${o.left}px`},children:r})]})]})},qe=({value:n,onValueChange:e,min:t=0,max:r=100,step:s=1,className:i=""})=>{const o=(n[0]-t)/(r-t)*100;return c.jsx("input",{type:"range",min:t,max:r,step:s,value:n[0],onChange:a=>e([parseFloat(a.target.value)]),className:`w-full h-1 bg-white/20 rounded-lg appearance-none cursor-pointer slider ${i}`,style:{"--progress":`${o}%`}})},Vt=({checked:n,onCheckedChange:e})=>c.jsx("button",{role:"switch","aria-checked":n,onClick:()=>e(!n),className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-white/50 focus:ring-offset-2 focus:ring-offset-black/50 ${n?"bg-blue-500":"bg-white/20"}`,children:c.jsx("span",{"aria-hidden":"true",className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${n?"translate-x-5":"translate-x-0"}`})}),te=({children:n,className:e=""})=>c.jsx("label",{className:`text-sm font-medium ${e}`,children:n}),Os=[{value:"1080p",label:"1080p",badge:"Full HD"},{value:"720p",label:"720p",badge:"HD"},{value:"480p",label:"480p",badge:null},{value:"360p",label:"360p",badge:null}],Ns=["Off","English","English - SDH","Japanese","Spanish"],Is=["#FFFFFF","#FF69B4","#808080","#7FFFD4","#8A2BE2","#FF0000","#00CED1","#FFA500","#FFC0CB","#1E90FF","#000080","#FFFF00"],$s=[.5,.75,1,1.25,1.5,2],As=["Space Grotesk","Arial","Georgia","Courier New","Verdana","Roboto"],Fs=({src:n,title:e,getProxyUrl:t})=>{const r=m.useRef(null),s=m.useRef(null),i=m.useRef(null),o=m.useRef(null),a=m.useRef(!1),l=m.useRef(null),u=m.useRef(!1),d=m.useRef(null),f=m.useRef(),h=m.useRef(null),[b,x]=m.useState(!1),[R,he]=m.useState(0),[L,F]=m.useState(0),[T,U]=m.useState(1),[N,me]=m.useState(!1),[Fr,wr]=m.useState(!1),[De,pt]=m.useState(!0),[Br,w]=m.useState(!0),[ge,j]=m.useState(null),Oe=m.useRef(b);m.useEffect(()=>{Oe.current=b},[b]);const[ne,Ne]=m.useState(!1),[se,V]=m.useState("main"),[Ur,ht]=m.useState(!1),[Ie,ie]=m.useState(!1),[zr,Vr]=m.useState(1),[$e,Hr]=m.useState("1080p"),[Gr,Jr]=m.useState(1),[oe,Wr]=m.useState("English"),[Ae,mt]=m.useState(30),[ye,gt]=m.useState(0),[yt,bt]=m.useState("#FFFFFF"),[Kr,qr]=m.useState(!0),[Yr,Xr]=m.useState(!0),[be,Qr]=m.useState("Space Grotesk"),[ae,Zr]=m.useState("disconnected"),[vt,xt]=m.useState(!1),[en,Bs]=m.useState("unavailable"),[tn,Us]=m.useState(null),[rn,zs]=m.useState(""),E=en==="connected"&&tn;m.useEffect(()=>{ne||setTimeout(()=>V("main"),300)},[ne]);const nn=m.useCallback(p=>{Zr(p),(p==="connected"||p==="hosting")&&ie(!0)},[]),_=Ms({onMessage:(p,v)=>{var S;return(S=f.current)==null?void 0:S.call(f,p,v)},onStatusChange:nn}),sn=m.useCallback((p,v)=>{if(!(E||!r.current)){if(_.partyRole==="host")if(p.type==="SYNC_REQUEST"){_.sendMessage({type:"SYNC_RESPONSE",time:r.current.currentTime,isPlaying:!r.current.paused},v);return}else _.sendMessage(p);switch(a.current=!0,p.type){case"PLAY":r.current.paused&&r.current.play();break;case"PAUSE":r.current.paused||r.current.pause();break;case"SEEK":Math.abs(p.time-r.current.currentTime)>1.5&&(r.current.currentTime=p.time);break;case"SYNC_RESPONSE":r.current.currentTime=p.time,p.isPlaying?r.current.play():r.current.pause();break}setTimeout(()=>{a.current=!1},200)}},[E,_.partyRole,_.sendMessage]);m.useEffect(()=>{f.current=sn});const Ct=_.peerId?`${window.location.origin}${window.location.pathname}?party=${_.peerId}`:"",on=()=>navigator.clipboard.writeText(Ct).then(()=>{xt(!0),setTimeout(()=>xt(!1),2e3)});m.useEffect(()=>{const p=new URLSearchParams(window.location.search).get("party");p&&!_.isPartyActive&&(ie(!0),_.joinParty(p))},[_.isPartyActive,_.joinParty]);const Fe=m.useCallback(()=>pt(!1),[]),we=m.useCallback(()=>{pt(!0),o.current&&clearTimeout(o.current),Oe.current&&(o.current=setTimeout(Fe,3e3))},[Fe]),ee=m.useCallback(()=>{if(E||!r.current)return;const p=r.current.paused;if(_.isPartyActive){if(a.current)return;_.sendMessage({type:p?"PLAY":"PAUSE"})}p?r.current.play():r.current.pause()},[E,_]),W=m.useCallback(p=>{if(E||!r.current||L<=0)return;const v=Math.max(0,Math.min(L,r.current.currentTime+p));if(_.isPartyActive){if(a.current)return;_.sendMessage({type:"SEEK",time:v})}r.current.currentTime=v},[L,E,_]),Be=m.useCallback(()=>{if(E||!r.current)return;const p=!r.current.muted;r.current.muted=p,me(p),U(p?0:r.current.volume||1)},[E]),Ue=p=>{const v=p[0];if(E||!r.current)return;U(v),r.current.volume=v;const S=v===0;r.current.muted=S,me(S)},ze=m.useCallback(p=>Ue([Math.max(0,Math.min(1,T+p))]),[T,Ue]),ve=m.useCallback(()=>{var p;document.fullscreenElement?document.exitFullscreen():(p=s.current)==null||p.requestFullscreen()},[]),an=m.useCallback(p=>{E||!r.current||(r.current.playbackRate=p,Vr(p))},[E]),Ve=m.useCallback(p=>{const v=r.current;if(!v)return;h.current&&(h.current.destroy(),h.current=null);const S=(p==null?void 0:p.toLowerCase().includes(".m3u8"))||(p==null?void 0:p.toLowerCase().includes("application/vnd.apple.mpegurl"));if(S&&K.isSupported()){let y=p;if(p.includes("/proxy?url="))try{const I=new URLSearchParams(p.split("?")[1]).get("url");y=decodeURIComponent(I)}catch(I){console.error("Failed to extract original URL from proxy:",I)}const z=y.substring(0,y.lastIndexOf("/")+1),k=new K({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:60,manifestLoadingTimeOut:2e4,manifestLoadingMaxRetry:3,levelLoadingTimeOut:2e4,levelLoadingMaxRetry:3,fragLoadingTimeOut:3e4,fragLoadingMaxRetry:6,xhrSetup:function(I,C){let M=C;console.log("HLS XHR Request:",{originalUrl:C,originalUrlBase:z});const un=window.location.host;if(C.includes(un)&&!C.includes("/proxy?url=")){const kt=C.split("/"),Ge=kt[kt.length-1];(Ge.includes(".m3u8")||Ge.includes(".ts"))&&(M=z+Ge,console.log("Corrected mis-resolved URL:",M))}else!C.startsWith("http")&&!C.includes("/proxy?url=")&&(M=z+C,console.log("Resolved relative URL:",M));t&&M.startsWith("http")&&!M.includes("/proxy?url=")&&(M=t(M),console.log("Proxied URL:",M)),M!==C&&I.open("GET",M,!0),I.setRequestHeader("User-Agent","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"),I.setRequestHeader("Referer",window.location.origin)}});k.loadSource(t?t(p):p),k.attachMedia(v),k.on(K.Events.MANIFEST_PARSED,(I,C)=>{if(console.log("HLS manifest parsed successfully",C),C.levels&&C.levels.length===0){j("No playable video streams found in this M3U8 file."),w(!1);return}w(!1)}),k.on(K.Events.MANIFEST_LOADING,()=>{console.log("Loading M3U8 manifest..."),j(null)}),k.on(K.Events.ERROR,(I,C)=>{if(console.error("HLS error:",C),C.details==="manifestLoadError"){console.log("Manifest load error - checking if URL is accessible");const M=C.url||p;M.includes("shadowlandschronicles.com")||M.includes("tmstr")?j(`❌ shadowlandschronicles.com Stream Blocked

This streaming service actively blocks external players and proxy access. While the stream works in VLC (which bypasses web security), it cannot be played in web browsers due to:

• Advanced CORS protection
• Domain whitelist restrictions
• Server-side access control

This is intentional protection by the streaming service to prevent unauthorized access. The stream can only be accessed through their official applications or authorized websites.`):M.includes("private")||M.includes("protected")?j("This stream appears to be from a private or protected server that blocks external access. These types of streams typically require special authentication or can only be accessed from specific domains/applications."):j("Failed to load the M3U8 playlist. The stream may be protected by CORS, require authentication, or be temporarily unavailable. Try testing the URL directly in a browser first."),w(!1),k.destroy(),h.current=null;return}if(C.details==="manifestParsingError"){console.log("Manifest parsing error - invalid M3U8 format"),j("The M3U8 file format is invalid or corrupted. Please verify the stream URL is correct."),w(!1),k.destroy(),h.current=null;return}if(C.fatal)switch(C.type){case K.ErrorTypes.NETWORK_ERROR:C.details==="fragLoadError"?(console.log("Fragment load error - stream may be invalid"),j("Video segments are failing to load. This stream may be broken, expired, or require special authentication."),w(!1),k.destroy(),h.current=null):C.details==="manifestLoadError"?(console.log("Manifest load error - stream may be inaccessible"),j("Cannot access the M3U8 stream. It may be geo-blocked, expired, or require authentication."),w(!1),k.destroy(),h.current=null):(console.log("Network error, trying to recover..."),j("Network error loading video. Retrying..."),setTimeout(()=>{try{k.startLoad(),j(null)}catch{j("Failed to load video. The stream may be unavailable.")}},3e3));break;case K.ErrorTypes.MEDIA_ERROR:console.log("Media error, trying to recover..."),j("Media error. Attempting to recover...");try{k.recoverMediaError(),setTimeout(()=>j(null),5e3)}catch{j("Video format not supported or corrupted.")}break;default:console.log("Fatal error, destroying HLS instance"),j("Unable to play this video. The stream may be incompatible or unavailable."),w(!1),k.destroy(),h.current=null;break}else C.details==="fragLoadError"?(k.fragLoadErrorCount||(k.fragLoadErrorCount=0),k.fragLoadErrorCount++,console.log("Fragment load error detected, but allowing proxy to handle MIME type correction"),k.fragLoadErrorCount>3?(console.log("Too many fragment errors, treating as fatal"),j("Multiple video segments are failing to load. This stream appears to be broken or expired."),w(!1),k.destroy(),h.current=null):console.log(`Non-fatal fragment error ${k.fragLoadErrorCount}/3`)):C.details==="fragParsingError"&&console.log(`Non-fatal ${C.details}, HLS will retry automatically`)}),h.current=k}else S&&v.canPlayType("application/vnd.apple.mpegurl"),v.src=t?t(p):p},[t]);m.useEffect(()=>{const p=r.current;if(!p)return;const v=()=>{u.current||he(p.currentTime)},S=()=>{F(p.duration),w(!1)},y=()=>{x(!0),d.current&&clearTimeout(d.current),w(!1),we()},z=()=>x(!1),k=()=>{d.current&&clearTimeout(d.current),w(!1)},I=()=>{u.current||!Oe.current||(d.current&&clearTimeout(d.current),d.current=setTimeout(()=>w(!0),300))};return p.addEventListener("timeupdate",v),p.addEventListener("loadedmetadata",S),p.addEventListener("playing",y),p.addEventListener("pause",z),p.addEventListener("waiting",I),p.addEventListener("canplay",k),(h.current?h.current.url:p.src)!==n&&(w(!0),j(null),Ve(n)),()=>{p.removeEventListener("timeupdate",v),p.removeEventListener("loadedmetadata",S),p.removeEventListener("playing",y),p.removeEventListener("pause",z),p.removeEventListener("waiting",I),p.removeEventListener("canplay",k),d.current&&clearTimeout(d.current),h.current&&(h.current.destroy(),h.current=null)}},[n,we,Ve]),m.useEffect(()=>{const p=v=>{if(document.activeElement.tagName==="INPUT"||document.activeElement.tagName==="TEXTAREA"||ne||Ie)return;const S={Space:ee,KeyK:ee,ArrowLeft:()=>W(-10),KeyJ:()=>W(-10),ArrowRight:()=>W(10),KeyL:()=>W(10),ArrowUp:()=>ze(.1),ArrowDown:()=>ze(-.1),KeyM:Be,KeyF:ve,Escape:()=>{Ne(!1),ie(!1)}};S[v.code]&&(v.preventDefault(),S[v.code]())};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[ee,W,ze,Be,ve,ne,Ie]),m.useEffect(()=>{const p=()=>wr(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",p),()=>document.removeEventListener("fullscreenchange",p)},[]);const He=m.useCallback(p=>{if(!i.current||L<=0)return;const v=i.current.getBoundingClientRect(),y=Math.min(Math.max(0,p-v.left),v.width)/v.width*L;he(y),r.current&&!E&&(r.current.currentTime=y)},[L,E]);m.useEffect(()=>{const p=S=>{if(!u.current)return;const y=S.touches?S.touches[0].clientX:S.clientX;He(y)},v=S=>{if(!u.current)return;u.current=!1;const y=S.changedTouches?S.changedTouches[0].clientX:S.clientX;if(!i.current||L<=0)return;const z=i.current.getBoundingClientRect(),I=Math.min(Math.max(0,y-z.left),z.width)/z.width*L;_.isPartyActive&&!E&&!a.current&&_.sendMessage({type:"SEEK",time:I}),r.current&&(r.current.currentTime=I)};return window.addEventListener("mousemove",p),window.addEventListener("touchmove",p),window.addEventListener("mouseup",v),window.addEventListener("touchend",v),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("touchmove",p),window.removeEventListener("mouseup",v),window.removeEventListener("touchend",v)}},[He,E,_,L]);const _t=p=>{u.current=!0;const v=p.touches?p.touches[0].clientX:p.clientX;He(v)},cn=L>0?R/L*100:0,ln=N||T===0?Kn:Jn,St=Br&&b,dn=()=>{const p={main:"Settings",quality:"Quality",subtitles:"Subtitles",settings:"Subtitle Settings",playback:"Playback",fonts:"Subtitle Font"},v=({label:y,value:z,onClick:k})=>c.jsxs("button",{onClick:k,className:"w-full flex justify-between items-center text-left p-3 rounded-lg hover:bg-white/10 transition-colors",children:[" ",c.jsx("span",{children:y})," ",c.jsxs("span",{className:"text-gray-400",children:[z," ›"]})," "]}),S={main:c.jsxs("div",{className:"space-y-1",children:[c.jsx(v,{label:"Quality",value:$e,onClick:()=>V("quality")}),c.jsx(v,{label:"Subtitles",value:oe,onClick:()=>V("subtitles")}),c.jsx(v,{label:"Subtitle Settings",value:"",onClick:()=>V("settings")}),c.jsx(v,{label:"Playback",value:"",onClick:()=>V("playback")})]}),quality:c.jsx("div",{className:"space-y-1 text-white",children:Os.map(y=>c.jsxs("button",{onClick:()=>Hr(y.value),className:`w-full flex items-center text-left p-3 rounded-lg hover:bg-white/10 ${$e===y.value?"text-white":"text-gray-300"}`,children:[c.jsx("div",{className:"w-6 mr-2",children:$e===y.value&&c.jsx(Je,{size:20})}),c.jsx("span",{children:y.label}),y.badge&&c.jsx("span",{className:"ml-2 text-xs text-red-400 font-semibold",children:y.badge})]},y.value))}),subtitles:c.jsxs("div",{className:"space-y-1 text-white",children:[c.jsx("input",{type:"file",ref:l,className:"hidden",accept:".srt,.vtt",onChange:()=>{}}),Ns.map(y=>c.jsxs("button",{onClick:()=>Wr(y),className:`w-full flex items-center text-left p-3 rounded-lg hover:bg-white/10 ${oe===y?"text-white":"text-gray-300"}`,children:[c.jsx("div",{className:"w-6 mr-2",children:oe===y&&c.jsx(Je,{size:20})}),c.jsx("span",{children:y})]},y))," ",c.jsxs("div",{className:"pt-2",children:[c.jsxs("button",{onClick:()=>{var y;return(y=l.current)==null?void 0:y.click()},className:"w-full flex items-center text-left p-3 rounded-lg text-gray-300 hover:bg-white/10 hover:text-white",children:[c.jsx("div",{className:"w-6 mr-2 text-gray-400",children:c.jsx(Hn,{size:18})}),c.jsx("span",{children:"Upload"})]}),c.jsxs("button",{onClick:()=>V("settings"),className:"w-full flex items-center text-left p-3 rounded-lg text-gray-300 hover:bg-white/10 hover:text-white",children:[c.jsx("div",{className:"w-6 mr-2 text-gray-400",children:c.jsx(Mt,{size:18})}),c.jsx("span",{children:"Customize"})]})]})]}),settings:c.jsxs("div",{className:"space-y-6",children:[c.jsx(v,{label:"Font",value:be,onClick:()=>V("fonts")}),c.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-4",children:[c.jsxs("div",{children:[c.jsx(te,{className:"block mb-3 text-gray-200",children:"Font Size"}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx(qe,{value:[Ae],onValueChange:y=>mt(y[0]),min:16,max:48,step:1}),c.jsxs("span",{className:"text-gray-400 tabular-nums",children:[Ae,"px"]})]})]}),c.jsxs("div",{children:[c.jsx(te,{className:"block mb-3 text-gray-200",children:"BG Blur"}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx(qe,{value:[ye],onValueChange:y=>gt(y[0]),min:0,max:100,step:5}),c.jsxs("span",{className:"text-gray-400 tabular-nums",children:[ye,"%"]})]})]})]}),c.jsxs("div",{children:[c.jsx(te,{className:"block mb-3 text-gray-200",children:"Color"}),c.jsx("div",{className:"grid grid-cols-6 gap-3",children:Is.map(y=>c.jsx("button",{className:`w-full h-8 rounded-lg border-2 ${yt===y?"border-white ring-2 ring-white ring-offset-2 ring-offset-black/50":"border-transparent hover:border-gray-500"}`,style:{backgroundColor:y},onClick:()=>bt(y),title:y},y))})]}),c.jsx("div",{className:"pt-2",children:c.jsx(q,{onClick:()=>{mt(30),gt(0),bt("#FFFFFF")},variant:"outline",className:"w-full",children:"Reset"})})]}),fonts:c.jsx("div",{className:"space-y-1 text-white",children:As.map(y=>c.jsxs("button",{onClick:()=>Qr(y),className:`w-full flex items-center text-left p-3 rounded-lg hover:bg-white/10 ${be===y?"text-white":"text-gray-300"}`,children:[c.jsx("div",{className:"w-6 mr-2",children:be===y&&c.jsx(Je,{size:20})}),c.jsx("span",{style:{fontFamily:y},children:y})]},y))}),playback:c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx(te,{className:"block mb-3 text-gray-200",children:"Speed"}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:$s.map(y=>c.jsx(q,{variant:zr===y?"default":"ghost",onClick:()=>an(y),className:"text-sm",disabled:E||_.isPartyActive,children:y===1?"1x":`${y}x`},y))})]}),c.jsxs("div",{className:"pt-2 space-y-4",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx(te,{className:"text-gray-200",children:"Autoplay next"}),c.jsx(Vt,{checked:Kr,onCheckedChange:qr})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx(te,{className:"text-gray-200",children:"Show next button"}),c.jsx(Vt,{checked:Yr,onCheckedChange:Xr})]})]})]})};return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"p-4 shrink-0 flex items-center border-b border-white/10",children:[se!=="main"&&c.jsx("button",{onClick:()=>V(se==="fonts"?"settings":"main"),className:"mr-4 p-2 -ml-2 rounded-full hover:bg-white/10",children:c.jsx(Pt,{size:20})}),c.jsx("h2",{className:"text-xl font-semibold text-white",children:p[se]})]}),c.jsx("div",{className:"p-4 overflow-y-auto overflow-x-hidden",children:c.jsx("div",{className:"settings-content-pane",children:S[se]},se)})]})};return c.jsxs(c.Fragment,{children:[c.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        .video-player-container { font-family: 'Space Grotesk', sans-serif; }
        .video-player-container video::cue { font-family: "${be}", sans-serif; font-size: ${Ae}px; color: ${yt}; background: rgba(0, 0, 0, ${ye/150}); backdrop-filter: blur(${ye/20}px); text-shadow: 2px 2px 4px rgba(0,0,0,0.7); }
        input[type=range].slider { -webkit-appearance: none; appearance: none; width: 100%; height: 4px; background: linear-gradient(to right, #ffffff var(--progress), rgba(255,255,255,0.3) var(--progress)); outline: none; transition: opacity .2s; cursor: pointer; border-radius: 2px; }
        input[type=range].slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #ffffff; border-radius: 50%; cursor: pointer; margin-top: 0px; }
        .volume-slider-container { transition: width 0.3s ease, opacity 0.3s ease; width: 0; opacity: 0; }
        .volume-group:hover .volume-slider-container { width: 80px; opacity: 1; margin-left: 8px; }
        .party-active { color: #38bdf8; }
        .settings-content-pane { animation: slideIn 0.25s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        google-cast-launcher { width: 44px; height: 44px; --cast-button-color: white; cursor: pointer; display: inline-block; vertical-align: middle; }
      `}),c.jsx("div",{className:"video-player-container w-full h-screen bg-black relative flex items-center justify-center text-white overflow-hidden",children:c.jsxs("div",{ref:s,className:`w-full h-full relative group ${!De&&b&&!E?"cursor-none":"cursor-pointer"}`,onMouseMove:we,onMouseLeave:b?Fe:void 0,children:[c.jsx("video",{ref:r,className:`w-full h-full object-contain ${E?"opacity-0 pointer-events-none":""}`,onClick:ee,onDoubleClick:ve,crossOrigin:"anonymous",children:oe!=="Off"&&c.jsx("track",{kind:"subtitles",label:oe,srcLang:"en",default:!0})}),E&&c.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black",children:[c.jsx(Ls,{className:"text-blue-400",width:80,height:80}),c.jsxs("p",{className:"text-2xl mt-4 font-semibold",children:["Casting to ",rn]}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Playback is controlled on this device."})]}),c.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:[St&&!ge&&c.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent"}),ge&&c.jsx("div",{className:"text-center p-6 max-w-md pointer-events-auto",children:c.jsxs("div",{className:"bg-red-500/20 border border-red-500/50 rounded-lg p-4 backdrop-blur-sm",children:[c.jsx("h3",{className:"text-lg font-semibold text-red-400 mb-2",children:"Video Error"}),c.jsx("p",{className:"text-sm text-gray-300 mb-4",children:ge}),c.jsx("button",{onClick:()=>{j(null),w(!0),Ve(n)},className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md transition-colors",children:"Retry"})]})}),De&&!b&&!St&&!ge&&c.jsx("button",{onClick:ee,className:"p-3 sm:p-4 pointer-events-auto transition-transform hover:scale-110 drop-shadow-lg","aria-label":"Play",children:c.jsx(jt,{size:64})})]}),c.jsxs("div",{className:`absolute inset-0 flex flex-col justify-between transition-opacity duration-300 z-30 pointer-events-none ${De?"opacity-100":"opacity-0"}`,children:[c.jsx("div",{className:"flex justify-between items-center p-4 md:p-6 bg-gradient-to-b from-black/70 to-transparent pointer-events-auto",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{className:"text-white hover:text-gray-300 transition-colors p-2 -ml-2",children:c.jsx(Pt,{size:28})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs md:text-sm text-gray-300",children:"You're watching"}),c.jsx("h1",{className:"text-lg md:text-xl font-semibold text-white truncate max-w-[calc(100vw-220px)]",children:e})]})]})}),c.jsxs("div",{className:"px-4 md:px-6 pt-2 pb-3 md:pb-4 bg-gradient-to-t from-black/80 to-transparent pointer-events-auto",children:[c.jsx("div",{ref:i,className:"w-full h-1 md:h-1.5 bg-white/30 rounded-full cursor-pointer mb-3 relative group/progress",onMouseDown:_t,onTouchStart:_t,children:c.jsx("div",{className:"h-full bg-white rounded-full relative group-hover/progress:h-2 transition-all duration-150 pointer-events-none",style:{width:`${cn}%`},children:c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover/progress:opacity-100 transition-opacity",style:{right:"-6px"}})})}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[c.jsx("button",{onClick:ee,className:"text-white p-2",children:b?c.jsx(Bn,{size:32}):c.jsx(jt,{size:32})}),c.jsx("button",{onClick:()=>W(-10),className:"text-white p-2",disabled:L===0,title:"Rewind 10s",children:c.jsx(ss,{size:28})}),c.jsx("button",{onClick:()=>W(10),className:"text-white p-2",disabled:L===0,title:"Forward 10s",children:c.jsx(is,{size:28})}),c.jsxs("div",{className:"hidden md:flex items-center volume-group",children:[c.jsx("button",{onClick:Be,className:"text-white p-2",title:"Mute",children:c.jsx(ln,{size:28})}),c.jsx("div",{className:"volume-slider-container",children:c.jsx(qe,{value:[N?0:T],onValueChange:Ue,min:0,max:1,step:.05})})]}),c.jsxs("span",{className:"text-base font-medium text-white/90 min-w-max tracking-wide",children:[Ut(R)," / ",Ut(L)]})]}),c.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[c.jsx(Ds,{open:Ur,onOpenChange:ht,trigger:c.jsx("button",{className:"text-white p-2",title:"Select Server",children:c.jsx(On,{size:28})}),children:c.jsxs("div",{className:"w-48 p-3",children:[c.jsx("h4",{className:"font-semibold text-white mb-2",children:"Select Server"}),c.jsx("div",{className:"space-y-1",children:[1,2,3,4].map(p=>c.jsxs(q,{variant:Gr===p?"default":"ghost",className:"w-full justify-start text-sm",onClick:()=>{Jr(p),ht(!1)},children:["Server ",p]},p))})]})}),c.jsx("button",{onClick:()=>ie(!0),className:`text-white p-2 transition-colors ${_.isPartyActive?"party-active":""}`,title:"Watch Party",children:c.jsx(Et,{size:28})}),c.jsx("button",{onClick:()=>Ne(!0),className:"text-white p-2",title:"Settings",children:c.jsx(Mt,{size:28})}),c.jsx("button",{onClick:ve,className:"text-white p-2",title:"Fullscreen",children:Fr?c.jsx(An,{size:28}):c.jsx(In,{size:28})})]})]})]})]}),c.jsx(zt,{open:Ie,onOpenChange:ie,children:c.jsxs("div",{className:"p-6 pt-12 text-center max-w-sm mx-auto",children:[c.jsxs("div",{className:"flex justify-center items-center mb-4",children:[c.jsx(Et,{className:"mr-3 text-blue-400",size:32}),c.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Watch Party"})]}),ae==="disconnected"&&c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-gray-400 mb-6",children:"Start a party to watch with friends. A shareable link will be generated."}),c.jsx(q,{onClick:()=>_.startParty(),className:"bg-blue-500 hover:bg-blue-600 text-white w-full",children:"Start a New Party"})]}),ae==="hosting"&&c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-gray-300 mb-2",children:"You are hosting! Share this link:"}),c.jsx("div",{className:"p-2 bg-black/30 border border-white/20 rounded-md text-sm text-gray-400 break-all mb-4",children:Ct}),c.jsxs(q,{onClick:on,variant:"outline",className:"w-full flex justify-center items-center space-x-2",children:[vt?c.jsx(jn,{size:16}):c.jsx(Ln,{size:16}),c.jsx("span",{children:vt?"Copied!":"Copy Link"})]}),c.jsx(q,{onClick:()=>_.endParty(),variant:"outline",className:"w-full border-red-500/50 text-red-400 hover:bg-red-500/20 hover:text-red-300 mt-4",children:"End Party"})]}),ae==="connecting"&&c.jsx("p",{className:"text-gray-300 animate-pulse",children:"Connecting to party..."}),ae==="connected"&&c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-lg text-green-400 font-bold mb-4",children:"Party Connected!"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"Playback is now synchronized with the host."}),c.jsx(q,{onClick:()=>_.endParty(),variant:"outline",className:"w-full border-red-500/50 text-red-400 hover:bg-red-500/20 hover:text-red-300",children:"Leave Party"})]}),ae==="error"&&c.jsx("p",{className:"text-red-400",children:"Connection failed. Please try again."})]})}),c.jsx(zt,{open:ne,onOpenChange:Ne,children:dn()})]})})]})};function ws(){const[n,e]=m.useState(""),[t,r]=m.useState(null),s=o=>{o.preventDefault(),n.trim()&&r({src:n,title:"M3U8 Video Player"})},i=o=>o?`/proxy?url=${encodeURIComponent(o)}`:"";return c.jsx("div",{className:"min-h-screen bg-gray-900 text-white",children:t?c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>r(null),className:"absolute top-4 left-4 z-50 bg-black/50 hover:bg-black/70 text-white px-4 py-2 rounded-md transition-colors",children:"← Back"}),c.jsx(Fs,{src:t.src,title:t.title,getProxyUrl:i})]}):c.jsx("div",{className:"flex items-center justify-center min-h-screen",children:c.jsx("div",{className:"max-w-md w-full mx-4",children:c.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6",children:[c.jsx("h1",{className:"text-3xl font-bold text-center mb-6",children:"M3U8 Video Player"}),c.jsx("p",{className:"text-gray-400 text-center mb-6",children:"Enter an M3U8 stream URL to start watching. This player supports HLS streams and handles CORS automatically."}),c.jsxs("form",{onSubmit:s,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"videoUrl",className:"block text-sm font-medium text-gray-300 mb-2",children:"M3U8 Stream URL"}),c.jsx("input",{type:"url",id:"videoUrl",value:n,onChange:o=>e(o.target.value),placeholder:"https://example.com/stream.m3u8",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),c.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Load Video"})]}),c.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-700",children:[c.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Features:"}),c.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[c.jsx("li",{children:"• HLS.js support for M3U8 streams"}),c.jsx("li",{children:"• CORS proxy for cross-origin requests"}),c.jsx("li",{children:"• Watch party sync with friends"}),c.jsx("li",{children:"• Quality selection and playback controls"}),c.jsx("li",{children:"• Subtitle support and customization"}),c.jsx("li",{children:"• Fullscreen mode"})]})]})]})})})})}Ye.createRoot(document.getElementById("root")).render(c.jsx(G.StrictMode,{children:c.jsx(ws,{})}));
